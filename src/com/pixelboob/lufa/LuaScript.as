package com.pixelboob.lufa {	import flash.utils.ByteArray;	import flash.utils.Endian;				/**	 * @author moj	 */	public class LuaScript extends LuaFunction	{		private var state : LuaState;		private var toggle : Boolean;		private var bytes : LuaByteArray;		public function LuaScript(byteArray:ByteArray)		{			this.state = new LuaState();			this.bytes = new LuaByteArray(state);			this.bytes.writeBytes(byteArray);			this.bytes.position = 0;			this.toggle = false;					parseHeader();						this.fromBytes(bytes);					}							/*********************************		 * File format		 */						private function parseHeader() : void		{			// Validate signature			if(!(bytes.readByte()==0x1b && bytes.readByte()==0x4C && bytes.readByte()==0x75 && bytes.readByte() == 0x61))	//		if(bytes.readBytes(4) != 0x1b4c7561)			{				throw new Error("Invalid signature");			}				state.version = bytes.readUnsignedByte();			state.formatVersion = bytes.readUnsignedByte();						state.endianness = bytes.readUnsignedByte();			bytes.endian = (state.endianness == 0 ? Endian.BIG_ENDIAN : Endian.LITTLE_ENDIAN);			state.intSize = bytes.readUnsignedByte();			state.size_tSize = bytes.readUnsignedByte();			state.instrSize = bytes.readUnsignedByte();			state.lua_NumberSize = bytes.readUnsignedByte();			state.integralFlag = bytes.readUnsignedByte();										trace("Version version: "+state.version);	//		trace("Major version: "+state.majorVersion);			trace("Format version: "+state.formatVersion);			trace("Endianness: "+state.endianness);			trace("intSize: "+state.intSize);			trace("size_tSize: "+state.size_tSize);			trace("instrSize: "+state.instrSize);			trace("lua_NumberSize: "+state.lua_NumberSize);			trace("integralFlag: "+state.integralFlag);		}	}}